{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{{ profile_user.username|default:"Profile" }} ‚Äì HelpLink</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- AOS Animation -->
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

  <style>
    .clickable {
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      cursor: pointer;
    }
    .clickable:hover {
      transform: scale(1.03);
      box-shadow: 0 8px 18px rgba(0, 0, 0, 0.12);
    }
    .active-card {
      border: 2px solid #fb7185;
      box-shadow: 0 0 12px rgba(251, 113, 133, 0.4);
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
  </style>
</head>

<body class="min-h-screen bg-gradient-to-br from-orange-50 via-rose-50 to-purple-50 pt-24 pb-12 px-4">
<div class="container mx-auto max-w-6xl">

  <!-- Profile Header -->
  <div data-aos="fade-up" class="p-8 mb-8 bg-white/80 backdrop-blur-sm border border-gray-200 rounded-2xl shadow-sm">
    <div class="flex flex-col md:flex-row gap-6 items-center md:items-start">
      <div class="flex-shrink-0">
        {% if profile_user.profile.avatar %}
          <img src="{{ profile_user.profile.avatar }}" alt="Avatar" class="w-32 h-32 rounded-full border-4 border-white shadow-lg object-cover">
        {% else %}
          <div class="w-32 h-32 rounded-full bg-gradient-to-r from-rose-500 to-orange-500 flex items-center justify-center text-white text-4xl font-bold shadow-lg">
            {{ profile_user.username|slice:":1"|upper|default:"U" }}
          </div>
        {% endif %}
      </div>

      <div class="flex-1 text-center md:text-left">
        <h1 class="text-gray-900 text-2xl font-semibold mb-2">
          {{ profile_user.profile.full_name|default:profile_user.username|default:"User" }}
        </h1>

        <div class="flex flex-wrap gap-2 justify-center md:justify-start mb-3">
          {% if profile_user.profile.is_top_helper %}
          <span class="bg-gradient-to-r from-rose-500 to-orange-500 text-white text-xs px-3 py-1 rounded-full flex items-center gap-1">
            ‚≠ê Top Helper
          </span>
          {% endif %}
          {% if profile_user.profile.location %}
          <span class="border border-gray-300 text-gray-700 text-xs px-3 py-1 rounded-full">
            {{ profile_user.profile.location }}
          </span>
          {% endif %}
          {% if profile_user.profile.phone %}
          <span class="border border-gray-300 text-gray-700 text-xs px-3 py-1 rounded-full">
            üìû {{ profile_user.profile.phone }}
          </span>
          {% endif %}
        </div>

        {% if profile_user.profile.bio %}
          <p class="text-gray-600 mb-3">{{ profile_user.profile.bio }}</p>
        {% endif %}

        <div class="flex items-center gap-2 text-sm text-gray-500 justify-center md:justify-start">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-gray-500" fill="none" viewBox="0 0 24 24"
            stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
          </svg>
          <span>Joined {{ profile_user.date_joined|date:"F Y" }}</span>
        </div>

        {% if request.user == profile_user %}
        <div class="mt-4 flex gap-2 justify-center md:justify-start">
          <a href="{% url 'edit_profile' username=request.user.username %}" class="bg-rose-500 text-white px-4 py-2 rounded-full hover:opacity-90 transition">
            Edit Profile
          </a>

          <a href="{% url 'logout' %}" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-full hover:bg-gray-300 transition">
            Logout
          </a>
        </div>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Tabs: Requests / Helped -->
  <div class="mt-8">
    <ul class="flex space-x-4 border-b mb-4 text-sm font-medium">
      <li><button class="tab-btn text-rose-500" data-tab="requests">Requests Posted</button></li>
      <li><button class="tab-btn text-gray-500 hover:text-rose-500" data-tab="helped">Helped</button></li>
    </ul>

    <!-- Requests Posted -->
    <div id="requests" class="tab-content active space-y-2">
      {% if profile_user.help_requests.exists %}
        {% for req in profile_user.help_requests.all %}
          <div class="p-4 bg-white rounded-lg shadow-sm border border-gray-200 clickable">
            <a href="{% url 'request_detail' req.id %}" class="font-semibold text-gray-800">{{ req.title }}</a>
            <p class="text-gray-500 text-sm">{{ req.description|truncatechars:80 }}</p>
            <div class="flex justify-between text-xs text-gray-400 mt-1">
              <span>{{ req.category|default:"General" }}</span>
              <span>Status: {{ req.status }}</span>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <p class="text-gray-500">No requests posted yet.</p>
      {% endif %}
    </div>

    <!-- Helped Requests -->
    <div id="helped" class="tab-content mt-6 space-y-2">
      {% if profile_user.requests_helped.exists %}
        {% for req in profile_user.requests_helped.all %}
          <div class="p-4 bg-white rounded-lg shadow-sm border border-gray-200 clickable">
            <a href="{% url 'request_detail' req.id %}" class="font-semibold text-gray-800">{{ req.title }}</a>
            <p class="text-gray-500 text-sm">{{ req.description|truncatechars:80 }}</p>
            <div class="flex justify-between text-xs text-gray-400 mt-1">
              <span>{{ req.category|default:"General" }}</span>
              <span>Status: {{ req.status }}</span>
            </div>
          </div>
        {% endfor %}
      {% else %}
        <p class="text-gray-500">No helped requests yet.</p>
      {% endif %}
    </div>
  </div>

</div>

<script>
  AOS.init({ duration: 800, once: true });

  // Card highlight
  function activateCard(el) {
    document.querySelectorAll('.clickable').forEach(c => c.classList.remove('active-card'));
    el.classList.add('active-card');
  }

  // Tabs functionality
  const tabBtns = document.querySelectorAll('.tab-btn');
  const tabContents = document.querySelectorAll('.tab-content');

  tabBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      const tab = btn.dataset.tab;

      tabContents.forEach(tc => tc.classList.remove('active'));
      document.getElementById(tab).classList.add('active');

      tabBtns.forEach(b => b.classList.remove('text-rose-500'));
      tabBtns.forEach(b => b.classList.add('text-gray-500'));
      btn.classList.add('text-rose-500');
      btn.classList.remove('text-gray-500');
    });
  });
</script>
</body>
</html>
